angular.module("LocalStorageModule").value("prefix","gaDatabase"),angular.module("xoApp",["LocalStorageModule","firebase"]).config(["$routeProvider",function(a){a.when("/how_to",{templateUrl:"views/how_to.html",controller:"HowToCtrl"}).when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/game",{templateUrl:"views/game.html",controller:"GameCtrl"}).when("/match_player",{templateUrl:"views/match_player.html",controller:"MatchPlayerCtrl"}).when("/multi_game/:id/:mySymbol",{templateUrl:"views/multi_game.html",controller:"MultiGameCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("xoApp").controller("MainCtrl",["$scope","localStorageService",function(){}]),angular.module("xoApp").controller("HowToCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("xoApp").controller("HomeCtrl",["$scope",function(){$("#gameboard").addClass("animated bounce")}]),angular.module("xoApp").controller("GameCtrl",["$scope","localStorageService","$timeout","angularFire","$routeParams",function(a,b,c){a.xCount=b.get("xWins"),a.oCount=b.get("oWins"),a.hideStartButtons=!1,a.showGameboard=!1,a.empty=" ",a.currentPlayer,a.computerOpponent,a.finished,a.showRestartButton=a.finished,a.cells=[],a.info,a.minutes="0",a.counterMinutes="0"+a.minutes,a.seconds="0",a.counterSeconds="0"+a.seconds;var d;a.stopTimer=function(){c.cancel(d)},a.startTimer=function(){d=c(function(){"59"==a.seconds?(a.minutes++,a.counterMinutes=a.minutes<=9?"0"+a.minutes:a.minutes,a.seconds="0",a.counterSeconds="0"+a.seconds):(a.seconds++,a.counterSeconds=a.seconds<=9?"0"+a.seconds:a.seconds),a.startTimer()},1e3)},a.refreshTimer=function(){a.minutes="0",a.counterMinutes="0"+a.minutes,a.seconds="0",a.counterSeconds="0"+a.seconds},a.startGameWithComputer=function(){a.initialize(!0)},a.startGameWithFriend=function(){a.initialize(!1)},a.initialize=function(c){b.get("name"),a.hideStartButtons=!0,a.showGameboard=!0,$("#gameboard").addClass("animated bounceIn"),a.refresh(),a.randomizePlayer(c)},a.randomizePlayer=function(b){var c=Math.floor(2*Math.random())+1;if(a.currentPlayer=1==c?"x":"o",a.info=a.currentPlayer+"'s turn!",b){var d=Math.floor(2*Math.random())+1;if(1==d)a.computerOpponent="x"==a.currentPlayer?"x":"o",a.makeOpponentMove(),a.info="Your turn as "+a.currentPlayer;else{var e=Math.floor(2*Math.random())+1;1==e?(a.currentPlayer="x",a.computerOpponent="o"):(a.currentPlayer="o",a.computerOpponent="x"),a.info="You play first, as "+a.currentPlayer}}},a.refresh=function(){a.finished=!1,a.showRestartButton=a.finished;for(var b=0;9>b;b++)a.cells[b]=a.empty;$("#gameboard").addClass("animated bounceIn"),a.computerOpponent?a.currentPlayer==a.computerOpponent?a.makeOpponentMove():a.info="Your turn as "+a.currentPlayer:a.info=a.currentPlayer+"'s turn!"},a.makeNextMove=function(c){if(a.cells[c-1]=a.currentPlayer,$("#gameboard").removeClass("animated bounceIn"),1==a.isWinning()){a.finished=!0,a.info=a.computerOpponent?a.computerOpponent==a.currentPlayer?"computer wins!":"you win!":a.currentPlayer+" wins!";var d=a.currentPlayer;"x"==d?(a.xCount++,b.add("xWins",a.xCount)):(a.oCount++,b.add("oWins",a.oCount))}else a.isATie()?(a.finished=!0,a.info="It's a tie!"):(a.currentPlayer="x"==a.currentPlayer?"o":"x",a.computerOpponent?a.computerOpponent==a.currentPlayer?a.makeOpponentMove():a.info="Your turn as "+a.currentPlayer:a.info=a.currentPlayer+"'s turn!")},a.handleClick=function(b){a.computerOpponent==a.currentPlayer||1==a.finished||a.currentSquareClickedAlready(b)||a.makeNextMove(b),a.showRestartButton=a.finished},a.currentSquareClickedAlready=function(b){return 0!=a.cells[b-1]?!0:void 0},a.isWinning=function(){return a.isHorizontalThreeOccupiedByMe(a.currentPlayer)||a.isVerticalThreeOccupiedByMe(a.currentPlayer)||a.isDiagonalThreeOccupiedByMe(a.currentPlayer)?!0:void 0},a.isHorizontalThreeOccupiedByMe=function(b){for(var c=!0,d=0;3>d;d++)a.cells[d]!=b&&(c=!1);if(0==c){c=!0;for(var d=3;6>d;d++)a.cells[d]!=b&&(c=!1)}if(0==c){c=!0;for(var d=6;9>d;d++)a.cells[d]!=b&&(c=!1)}return c},a.isVerticalThreeOccupiedByMe=function(b){for(var c=!0,d=0;9>d;d+=3)a.cells[d]!=b&&(c=!1);if(0==c){c=!0;for(var d=1;9>d;d+=3)a.cells[d]!=b&&(c=!1)}if(0==c){c=!0;for(var d=2;9>d;d+=3)a.cells[d]!=b&&(c=!1)}return c},a.isDiagonalThreeOccupiedByMe=function(b){for(var c=!0,d=0;9>d;d+=4)a.cells[d]!=b&&(c=!1);if(0==c){c=!0;for(var d=2;7>d;d+=2)a.cells[d]!=b&&(c=!1)}return c},a.makeOpponentMove=function(){do var b=Math.floor(9*Math.random())+1;while(a.cells[b-1]!=a.empty);a.makeNextMove(b)},a.isATie=function(){for(var b=!0,c=0;9>c;c++)a.cells[c]==a.empty&&(b=!1);return b}}]),angular.module("xoApp").directive("tickleMe",function(){return{restrict:"A",link:function(a,b){b.bind("click",function(){alert("Don't tickle me!")})}}}),angular.module("xoApp").controller("MatchPlayerCtrl",["$scope","angularFire","$location",function(a,b,c){function d(){return Math.floor(16777215*Math.random()).toString(16)}a.waitingRoom={};var e=new Firebase("https://hkwdi-tictactoe.firebaseio.com/waiting_room");a.p=b(e,a,"waitingRoom"),a.p.then(function(){1==a.waitingRoom.xJoined?a.joinWaitingRoom():a.createWaitingRoom()}),a.createWaitingRoom=function(){a.waitingRoom={xJoined:!0,gameBoardNumber:d()},a.noticeMessage="You are player x, waiting for opponent.....",e.on("child_removed",function(){c.path("multi_game/"+a.waitingRoom.gameBoardNumber+"/x")})},a.joinWaitingRoom=function(){var b=a.waitingRoom.gameBoardNumber;a.waitingRoom={},c.path("multi_game/"+b+"/o")}}]),angular.module("xoApp").controller("MultiGameCtrl",["$scope","localStorageService","$timeout","angularFire","$routeParams",function(a,b,c,d,e){function f(a,b){return!(b>a||a>b)}a.gameBoardId=e.id,a.mySymbol=e.mySymbol,a.currentPlayer="x",a.cells=[],a.showLeaderBoard=!1;var g=new Firebase("https://hkwdi-tictactoe.firebaseio.com/"+e.id+"/room"),h=new Firebase("https://hkwdi-tictactoe.firebaseio.com/"+e.id+"/leaderData");a.promise=d(g,a,"cells"),a.leaderData={},a.p=d(h,a,"leaderData"),a.promise.then(function(){a.userName=prompt("What is your name?"),a.cells=[" "," "," "," "," "," "," "," "," "],"x"==e.mySymbol?(console.log("I am First Move: Symbol: "+e.mySymbol),a.myTurn=!0,a.info="You start as player x",a.leaderData[a.userName]=0):(console.log("I am Second Move: Symbol: "+e.mySymbol),a.myTurn=!1,a.info="You are player o Player x moves first",a.leaderData[a.userName]=0)}),a.getName=function(){a.userName=prompt("What is your name?")},a.addWinToLeaderboard=function(){a.userName&&(a.leaderData.hasOwnProperty(a.userName)?a.leaderData[a.userName]++:a.leaderData[a.userName]=1)},g.on("value",function(b){console.log("wait received!"),1==a.finished&&(f(b.val(),a.cells)?console.log("same gameboard"):(console.log("my turn - diff gameboard"),console.log("refresh!"),a.refresh())),a.myTurn?console.log("it is my turn but I receive "):null!=b.val()?f(b.val(),a.cells)?console.log("same gameboard"):(console.log("diff gameboard"),a.cells=b.val(),a.cells==[" "," "," "," "," "," "," "," "," "]?(console.log("refresh!"),a.refresh()):(a.myTurn=!0,a.info="Your turn!"),(a.isWinning("x")||a.isWinning("o"))&&(console.log("Won!"),a.finished=!0,a.info=a.isWinning("x")?"x wins!":"o wins!"),a.isDraw()&&(console.log("Draw!"),a.finished=!0,a.info="It's a draw!"),a.showRestartButton=a.finished):console.log("snapshot is empty")}),a.handleClick=function(b){$("#gameboard").removeClass("animated bounceIn"),a.myTurn?1==a.finished||a.currentSquareClickedAlready(b)||(a.cells[b]=a.mySymbol,a.myTurn=!1,a.isWinning(a.mySymbol)?(a.info="You win!!",a.finished=!0,console.log("Won inside click!"),a.addWinToLeaderboard()):a.isDraw()?(a.finished=!0,console.log("Draw!"),a.info="It's a draw!"):a.info="x"==a.mySymbol?"player o's turn!":"player x's turn!"):console.log("Not my turn!"),a.showRestartButton=a.finished},a.currentSquareClickedAlready=function(b){return" "==a.cells[b]?!1:!0},a.isWinning=function(b){return a.isHorizontalThreeOccupiedByMe(b)||a.isVerticalThreeOccupiedByMe(b)||a.isDiagonalThreeOccupiedByMe(b)?!0:void 0},a.isDraw=function(){for(var b=!0,c=0;9>c;c++)(" "==a.cells[c]||null==a.cells[c])&&(b=!1);return b},a.refresh=function(){a.finished=!1,$("#gameboard").addClass("animated bounceIn"),a.cells=[" "," "," "," "," "," "," "," "," "],a.showRestartButton=a.finished,a.showLeaderBoard=!0,a.myTurn?(console.log("I am First Move: Symbol: "+e.mySymbol),a.info="You start as player "+e.mySymbol):(console.log("I am Second Move: Symbol: "+e.mySymbol),a.myTurn=!1,a.info="You are player "+e.mySymbol+": Your opponent moves first")},a.finished=!1,a.showRestartButton=a.finished,a.info,a.minutes="0",a.counterMinutes="0"+a.minutes,a.seconds="0",a.counterSeconds="0"+a.seconds;var i;a.stopTimer=function(){c.cancel(i)},a.startTimer=function(){i=c(function(){"59"==a.seconds?(a.minutes++,a.counterMinutes=a.minutes<=9?"0"+a.minutes:a.minutes,a.seconds="0",a.counterSeconds="0"+a.seconds):(a.seconds++,a.counterSeconds=a.seconds<=9?"0"+a.seconds:a.seconds),a.startTimer()},1e3)},a.refreshTimer=function(){a.minutes="0",a.counterMinutes="0"+a.minutes,a.seconds="0",a.counterSeconds="0"+a.seconds},a.isHorizontalThreeOccupiedByMe=function(b){for(var c=!0,d=0;3>d;d++)a.cells[d]!=b&&(c=!1);if(0==c){c=!0;for(var d=3;6>d;d++)a.cells[d]!=b&&(c=!1)}if(0==c){c=!0;for(var d=6;9>d;d++)a.cells[d]!=b&&(c=!1)}return c},a.isVerticalThreeOccupiedByMe=function(b){for(var c=!0,d=0;9>d;d+=3)a.cells[d]!=b&&(c=!1);if(0==c){c=!0;for(var d=1;9>d;d+=3)a.cells[d]!=b&&(c=!1)}if(0==c){c=!0;for(var d=2;9>d;d+=3)a.cells[d]!=b&&(c=!1)}return c},a.isDiagonalThreeOccupiedByMe=function(b){for(var c=!0,d=0;9>d;d+=4)a.cells[d]!=b&&(c=!1);if(0==c){c=!0;for(var d=2;7>d;d+=2)a.cells[d]!=b&&(c=!1)}return c}}]);